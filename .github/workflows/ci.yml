name: Build Auritia

on: [push, pull_request, workflow_dispatch]

jobs:
  build-linux:
    name: "🐧 Compile for Linux"
    # runs-on: ubuntu-latest
    runs-on: self-hosted
    steps: 

    - name: 🧪 Environment Info
      run: "npx envinfo"

    - name: 🛎 Checkout
      uses: actions/checkout@v2

    # These are preinstalled in our self-hosted Auritia runners
    # So I will leave them commented out for now, but for anyone
    # Else who needs to run actions uncomment this and it should work for you

    # - name: ⚡ Install System Dependancies 
    #   run: "sudo apt update && sudo apt install -y libwebkit2gtk-4.0-dev build-essential curl wget libssl-dev libgtk-3-dev libappindicator3-dev patchelf librsvg2-dev"

    # - name: ⚡ Install linker (multilib)
    #   run: "sudo apt install gcc-multilib -y"

    # - name: ⚡ Install linker (mips)
    #   run: "sudo apt install gcc-mips-linux-gnu -y"
      
    # - name: ⚡ Install linker (mipsel)
    #   run: "sudo apt install gcc-mipsel-linux-gnu -y"

    # - name: ⚡ Install linker (aarch64)
    #   run: "sudo apt install gcc-aarch64-linux-gnu -y"

    # - name: ⚡ Test Tauri
    #   run: "npm run tauri"

    - name: ⚡ Install NPM Dependancies
      run: "npm i"

    - name: 🛠 Build 
      run: npm run compile

    - name: 🗳 Upload artifact 
      uses: actions/upload-artifact@v1
      with:
        name: auritia_compiled_linux_${{matrix.targetPlatform}}
        path: src-tauri/target/release/auritia

    - name: 🧼 Cleanup
      run: "sudo apt autoremove"