name: Build Auritia

on: [push, pull_request, workflow_dispatch]

jobs:
  build-linux:
    name: "🐧 Compile for Linux"
    runs-on: ubuntu-latest
    # runs-on: self-hosted
    strategy:
      fail-fast: false
      matrix:
        targetPlatform: 
          - x86_64
          - i686
          - aarch64
          - mips
          - mipsel
    steps:

    - name: 🛎 Checkout
      uses: actions/checkout@v2

    - name: ⚡ Install System Dependancies 
      run: "sudo apt update && sudo apt install -y libwebkit2gtk-4.0-dev build-essential curl wget libssl-dev libgtk-3-dev libappindicator3-dev patchelf librsvg2-dev"

    - name: ⚡ Setup Node 17.1.0
      uses: actions/setup-node@v2
      with:
        node-version: '17.1.0'

    - name: ⚡ Setup Cargo
      uses: actions-rs/toolchain@v1
      with:
        toolchain: stable

    - name: ⚡ Install Tauri CLI 
      run : cargo install tauri-cli --version ^1.0.0-beta

    - name: ⚡ Install linkers
      run: "sudo apt install -y gcc-multilib gcc-mips-linux-gnu gcc-mipsel-linux-gnu gcc-aarch64-linux-gnu"

    - name: ⚡ Install NPM Dependancies
      run: "npm i"

    - name: 🛠 Build 
      run: npm run compile

    - name: 🗳 Upload artifact 
      uses: actions/upload-artifact@v1
      with:
        name: auritia_compiled_linux_${{matrix.targetPlatform}}
        path: src-tauri/target/release/auritia

    - name: 🧼 Cleanup
      run: "sudo apt autoremove"