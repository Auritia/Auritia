name: Build Auritia

on: [push, pull_request, workflow_dispatch]

jobs:
  build-linux:
    name: "🐧 Compile for Linux"
    # runs-on: ubuntu-latest
    runs-on: self-hosted
    strategy:
      fail-fast: false
      matrix:
        targetPlatform: 
          - x86_64
          - i686
          - aarch64
          - mips
          - mipsel
    steps: 

    - name: Fix Cargo
      run: "source $HOME/.cargo/env"

    - name: 🛎 Checkout
      uses: actions/checkout@v2

    # - name: ⚡ Install System Dependancies 
    #   run: "sudo apt update && sudo apt install -y libwebkit2gtk-4.0-dev build-essential curl wget libssl-dev libgtk-3-dev libappindicator3-dev patchelf librsvg2-dev"

    # - name: ⚡ Install linker (multilib)
    #   run: "sudo apt install gcc-multilib -y"

    # - name: ⚡ Install linker (mips)
    #   run: "sudo apt install gcc-mips-linux-gnu -y"
      
    # - name: ⚡ Install linker (mipsel)
    #   run: "sudo apt install gcc-mipsel-linux-gnu -y"

    # - name: ⚡ Install linker (aarch64)
    #   run: "sudo apt install gcc-aarch64-linux-gnu -y"

    - name: ⚡ Install NPM Dependancies
      run: "npm i"


    - name: ⚡ Test Tauri
      run: "npm run tauri"

    - name: 🛠 Build 
      run: npm run compile

    - name: 🗳 Upload artifact 
      uses: actions/upload-artifact@v1
      with:
        name: auritia_compiled_linux_${{matrix.targetPlatform}}
        path: src-tauri/target/release/auritia

    - name: 🧼 Cleanup
      run: "sudo apt autoremove"